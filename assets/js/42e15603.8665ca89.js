"use strict";(self.webpackChunkcluster_factory_ce_docs=self.webpackChunkcluster_factory_ce_docs||[]).push([[7411],{7942:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var a=n(959);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(n),m=r,g=d["".concat(s,".").concat(m)]||d[m]||u[m]||o;return n?a.createElement(g,i(i({ref:t},c),{},{components:n})):a.createElement(g,i({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var p=2;p<o;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},6882:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var a=n(665),r=(n(959),n(7942));const o={},i="Overview",l={unversionedId:"guides/storage/overview",id:"guides/storage/overview",title:"Overview",description:"Introduction",source:"@site/docs/guides/90-storage/01-overview.md",sourceDirName:"guides/90-storage",slug:"/guides/storage/overview",permalink:"/docs/guides/storage/overview",draft:!1,editUrl:"https://github.com/deepsquare-io/ClusterFactory/tree/main/web/docs/guides/90-storage/01-overview.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{},sidebar:"docs",previous:{title:"Deploy a VM with KubeVirt",permalink:"/docs/guides/kubevirt/deploy-vm"},next:{title:"Storage Architecture",permalink:"/docs/guides/storage/storage-architecture"}},s={},p=[{value:"Introduction",id:"introduction",level:2},{value:"Requirements",id:"requirements",level:2}],c={toc:p};function u(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"overview"},"Overview"),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"While ClusterFactory was mainly made for being a control plane for SLURM, this guide provides step-by-step instructions for deploying Rook, an open-source storage orchestrator for Kubernetes, with a focus on setting up a scalable and maintainable control plane. Rook enables the deployment and management of storage solutions such as CephFS volumes (shared storage), object storage and block storage within your Kubernetes cluster."),(0,r.kt)("p",null,"The following sections will walk you through the process of deploying Rook, starting from the prerequisites and requirements to the configuration of a resilient control plane. By following this guide, you will be able to provision storage resources and ensure high availability, scalability, and ease of maintenance for your storage plane."),(0,r.kt)("h2",{id:"requirements"},"Requirements"),(0,r.kt)("p",null,"Before you begin the deployment process, ensure you have the following prerequisites in place:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Label your nodes. This is used to identify which nodes contain which disk. Examples of labels are ",(0,r.kt)("inlineCode",{parentName:"p"},"storage/disktype=ssd")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"storage=true"),". Apply these labels with:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl label nodes <node-name> storage=true\n")),(0,r.kt)("p",{parentName:"li"},"Pods can select the node using a ",(0,r.kt)("inlineCode",{parentName:"p"},"nodeSelector")," like this:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx\n  labels:\n    env: test\nspec:\n  containers:\n    - name: nginx\n      image: nginx\n      imagePullPolicy: IfNotPresent\n  nodeSelector:\n    storage/disktype: ssd\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"(optional) Taints your nodes. This avoids running compute workloads on the storage nodes. If you want to allow workloads on the storage node, you can ignore this requirement. You can taint a node with:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl taint nodes <node-name> storage=true:NoSchedule\n")),(0,r.kt)("p",{parentName:"li"},"To allow pods to run on a node with a taint, the pods can use ",(0,r.kt)("inlineCode",{parentName:"p"},"tolerations")," like this:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx\n  labels:\n    env: test\nspec:\n  containers:\n    - name: nginx\n      image: nginx\n      imagePullPolicy: IfNotPresent\n  tolerations:\n    - key: 'storage'\n      operator: 'Equal'\n      value: 'true'\n      effect: 'NoSchedule'\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Node resources: ",(0,r.kt)("strong",{parentName:"p"},"Nodes must either have one of these local storage: raw partitions, raw devices, LVM logical volumes or persistent volumes in ",(0,r.kt)("inlineCode",{parentName:"strong"},"block")," mode (no partition table, no data, no filesystem).")," Rook will automatically format these disks/partitions. Confirm with the following command:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"lsblk -f\n\n# NAME                  FSTYPE      LABEL UUID                                   MOUNTPOINT\n# vda\n# \u2514\u2500vda1                LVM2_member       >eSO50t-GkUV-YKTH-WsGq-hNJY-eKNf-3i07IB\n#   \u251c\u2500ubuntu--vg-root   ext4              c2366f76-6e21-4f10-a8f3-6776212e2fe4   /\n#   \u2514\u2500ubuntu--vg-swap_1 swap              9492a3dc-ad75-47cd-9596-678e8cf17ff9   [SWAP]\n# vdb\n")),(0,r.kt)("p",{parentName:"li"},"The ",(0,r.kt)("inlineCode",{parentName:"p"},"FSTYPE")," field should be empty. Here, only ",(0,r.kt)("inlineCode",{parentName:"p"},"vdb")," is available since it is an empty device with no filesystem.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"About LVM: LVM should be installed on the nodes using your favorite package manager:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"yum install -y lvm2\n# OR\napt install -y lvm2\n")),(0,r.kt)("p",{parentName:"li"},"The LVM version should be greater than ",(0,r.kt)("strong",{parentName:"p"},"1.5.0"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"About Rados Block Devices (RBD): the ",(0,r.kt)("inlineCode",{parentName:"p"},"rbd")," kernel module should be loaded."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'# Manually\nmodprobe rbd\n# Automatically at each boot:\necho "rbd" > /etc/modules-load.d/rbd.conf\n')),(0,r.kt)("p",{parentName:"li"},"If the Kubernetes nodes are running a 5.4 or later kernel, additional feature flags can be enabled in the storage class. The ",(0,r.kt)("inlineCode",{parentName:"p"},"fast-diff")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"object-map")," features are especially useful."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"imageFeatures: layering,fast-diff,object-map,deep-flatten,exclusive-lock\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"About CephFS: the recommended minimum kernel version is ",(0,r.kt)("strong",{parentName:"p"},"4.17")," to support storage quotas."))))}u.isMDXComponent=!0}}]);